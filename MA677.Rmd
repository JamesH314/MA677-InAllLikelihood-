---
title: "MA677"
author: "Yifeng He"
date: "5/5/2022"
output: pdf_document
---

```{r setup, include=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 4.25
A coin with probability p for heads is tossed n times. Let E be the event “a head is obtained on the first toss’ and Fk the event ‘exactly k heads are obtained.” For which pairs (n, k) are E and Fk independent?

```{r}
#I found reference in this website.
#https://stackoverflow.com/questions/24211595/order-statistics-in-r?msclkid=fd6683dac5671

f <- function(x, mu=0, sigma=1) dunif(x, mu, sigma)
F <- function(x, mu=0, sigma=1) punif(x, mu, sigma, lower.tail=FALSE)

integrand <- function(x,r,n) {
  x * (1 - F(x))^(r-1) * F(x)^(n-r) * f(x)
}

E <- function(r,n) {
  (1/beta(r,n-r+1)) * integrate(integrand,-Inf,Inf, r, n)$value
}


med <- function(i,n)
  { 
  medi<-(i-1/3)/(n+1/3) 
  return(medi)
}

E(2.5,5)

med(2.5,5)

E(5,10)

med(5,10)
```

## 4.27

```{r}
Jan_1940<-c(0.15,0.25,0.10,0.20,1.85,1.97,0.80,0.20,0.10,0.50,0.82,0.40,1.80,0.20,1.12,1.83,
       0.45,3.17,0.89,0.31,0.59,0.10,0.10,0.90,0.10,0.25,0.10,0.90)
Jul_1940<-c(0.30,0.22,0.10,0.12,0.20,0.10,0.10,0.10,0.10,0.10,0.10,0.17,0.20,2.80,0.85,0.10,
       0.10,1.23,0.45,0.30,0.20,1.20,0.10,0.15,0.10,0.20,0.10,0.20,0.35,0.62,0.20,1.22,
       0.30,0.80,0.15,1.53,0.10,0.20,0.30,0.40,0.23,0.20,0.10,0.10,0.60,0.20,0.50,0.15,
      0.60,0.30,0.80,1.10)
```

# (a) Compare the summary statistics for the two months.
```{r}
summary(Jan_1940)
summary(Jul_1940)
```

# (b) Look at QQ-plot
Should try out different plots, like glm.
```{r}
qqnorm(Jan_1940)
qqline(Jan_1940)

qqnorm(Jul_1940)
qqline(Jul_1940)
```

# (c) Fit gamma model and compare parameters
```{r}
install.packages('fitdistrplus')
library(fitdistrplus)

fit_Jan <- fitdist(Jan_1940, distr = "gamma", method = "mle")
fit_Jul <- fitdist(Jul_1940, distr = "gamma", method = "mle")

summary(fit_Jan)
summary(fit_Jul)
```
The profile likelihood shown below. July's model is slightly better than Jan's model.
```{r}
x = Jan_1940 
prof_log_lik=function(a){
   b=(optim(1,function(z) -sum(log(dgamma(x,a,z)))))$par
   return(-sum(log(dgamma(x,a,b))))
 }
 vx=seq(.1,3,length=40)
 vl=-Vectorize(prof_log_lik)(vx)
 plot(vx,vl,type="l")

 
y = Jul_1940 
prof_log_lik_y=function(a){
   b=(optim(1,function(z) -sum(log(dgamma(y,a,z)))))$par
   return(-sum(log(dgamma(y,a,b))))
 }
 vx=seq(.1,3,length=40)
 vl=-Vectorize(prof_log_lik_y)(vx)
 plot(vx,vl,type="l")
```


# (d) Check gamma model
Jul is a little bit better fit.
```{r}
set.seed(2022);

Jan <- sort(Jan_1940);
Jan0 <- qgamma(ppoints(length(Jan)), shape = 2, rate = 1);
plot(x = Jan0, y = Jan, xlab = "Theoretical quantiles", ylab = "Observed quantiles");
abline(a = 0, b = 1, col = "red");

Jul <- sort(Jul_1940);
Jul0 <- qgamma(ppoints(length(Jul)), shape = 2, rate = 1);
plot(x = Jul0, y = Jul, xlab = "Theoretical quantiles", ylab = "Observed quantiles");
abline(a = 0, b = 1, col = "red");
```


## 4.39
```{r}
weight <- c(0.4,1.0,1.9,3.0,5.5,8.1,12.1,25.6,50,56,70,115.0,115.0,119.5,154.5,157,175.0,179.0,180.0,406.0,419.0,
            423.0,440.0,655.0,680.0,1320.0,4603.0,5712.0)

bc <- boxcox(weight ~ 1)
lambda <- bc$x[which.max(bc$y)]
lambda

new_data <- data.frame((weight^lambda-1)/lambda)

new_model <- lm(((weight^lambda-1)/lambda) ~ weight)
summary(new_model)
```


## Illinois
Use the data to identify the distribution of rainfall produced by the storms in southern Illinois. Estimate the parameters of the distribution using MLE. Prepare a discussion of your estimation, including how confident you are about your identification of the distribution and the accuracy of your parameter estimates.

Using this distribution, identify wet years and dry years. Are the wet years wet because there were more storms, because individual storms produced more rain, or for both of these reasons?

To what extent do you believe the results of your analysis are generalizable? What do you think the next steps would be after the analysis? An article by Floyd Huff, one of the authors of the 1967 report is included.
```{r}
readxl::read_xlsx("Illinois_rain_1960-1964(1).xlsx")


```
